Sentinel-2 Toolbox Release Notes
================================

Changes in S2TBX 4.0
--------------------

### Main features

#### Sentinel-2 Product Reader

##### "Long Paths" issue on Windows

Multiple fixes for minimizing the impact of the "Long Paths" issue
on Windows OS. As long as you managed to uncompress a Sentinel-2 product
on your HDD from the Windows Explorer, it will open correctly inside SNAP

##### Only multi-size product reading

The specific 10m, 20m and 60m readers have been removed. They were doing
an automatic nearest neighbor resampling of any band to the target resolution,
and this work is much better done with the Resampling operator, available
via the Raster->Geometric Operations->Resampling menu.
The Resampling operator allows for more choices of the target resolution,
and allows one to choose the up and downsampling algorithms.

This also has the advantage that products where all granules are in the same
UTM zone are read automatically by a single reader, so does not trigger the
combo box for choosing the actual reader to use anymore.
Products containing granules in several distincts UTM zones still require the
user to choose which UTM zone to read.

The Level-2A reader, reading products produced by Sen2Cor, has been updated
to provide multi-size products, in line with what is done for L1C products.
It chooses the most precise resolution available for each band : L1C products
processed by sen2cor up to 20m will have B1 and B9 at 60m, and all other bands at 20m.
L1C products processed by sen2cor up to 10m will have B1 and B9 at 60m, B5/B6/B7/B8a/B11/B12 at 20m,
and B2/B3/B4/B8 at 10m.

##### S2 product can be opened using their directory

It is now possible to drag-and-drop the directory containing a S2 product
into the Product Explorer window to open them. No need to go find the xml
file anymore.

##### Reflectance scaling

The scale factor of 10000 used to convert reflectance from their raw integer
value to a meaningful reflectance value in [0, 1] is applied during product reading.

In the L2A product reader, appropriate scaling factors are applied to AOT and WVP bands
to produce physical values.

##### Metadata improvements

The granule-specific metadata were not easily distinguishable.
They now contain the MGRS tile identifier.

##### L2A Products now compatible with GPT

A small issue prevented L2A products from being used with the GPT.
This is now fixed.

##### Sun and Viewing angles

* The angles are now read at their original resolution, as provided in
the metadata (5000 m). This will reduce a lot the HDD space requirements
when converting S2 products to other format (BEAM-DIMAP, GeoTIFF).

* The angles grids of adjacent tiles are automatically mosaicked.
Since their resolution (5000m) is not compatible with the distance
between two adjacent tiles (99960m), adjacent angles grid are interpolated
to produce a mosaic at 5000m resolution. This particular issue has been
reported to the S2-MPC.

* Viewing angles retrieval from the metadata was buggy in previous SNAP versions.
Now the Sentinel-2 reader produces one viewing angle grid for each band independently,
merging the different viewing angle grids of each detector into one single image.
For ease of use, a mean viewing angle grid is also provided, which averages
the data provided by each band-specific grid.
Their actual use in processors is still problematic since S2 products do not
provide precise enough information about the detector from which a reflectance
band pixel has been interpolated from. In the neighborhood of a detector switch,
the viewing angles thus cannot be trusted.

##### Product time information

S2 products now include proper time information (Sensing start/stop time).

##### Masks grouping

Masks are now grouped by category, to avoid the masks folder to be too populated.

#####Â Level-2A Scene Classification colors

The different indices of the Scene Classification now follow the Sen2Cor documentation.
For consistency, the masks generated for each class in the Scene Classification band 
also follow the same colors.

##### Level-3 Products support

Added support for the Level-3 products as generated by Sen2Three,
the multitemporal synthesis processor, developed by Telespazio Vega Gmbh

##### Product loading time optimizations

* OpenJPEG, the underlying tool which decompress the JP2 images has been updated
to include important performance optimizations.

* The GML masks loading has been optimized

* The cloud masks (opaque_clouds and cirrus_clouds) available in L1C products,
and copied as-is in L2A products by Sen2Cor, are not read by default anymore.
A preference option allows to activate their reading and interpretation.


#### Spot 6/7 reader

##### RGB rendering

RGB rendering of Spot 6/7 products appeared overly dark. These has been fixed, 
by not using the histogram provided in the metadata.

The order of the bands has been fixed for the default profile.

#### Cache management

The Sentinel-2 Toolbox caches uncompressed regions of the JPEG2000 files
read by the Sentinel-2 reader, the generic JP2 reader and the Spot 6/7 reader.
Those files are stored in the user home directory and can grow big.

The cache can now be emptied regularly at startup. The frequency of the cache
clean up can be tuned in the preferences pane.
The default behavior for new installation is to remove from the cache the files
that are more-than-a-week old.

#### New L2B Biophysical Products processor

The Sentinel-2 Toolbox now provides a biophysical products processor,
developped by CS and INRA.

The processor computes LAI, FAPAR, FCOVER, CWC, CCC from top-of-canopy reflectances.

#### New IdePix Processor

The Sentinel-2 Toolbox now includes the Idepix Processor for Sentinel-2,
developped by Brockmann Consult Gmbh.

The Idepix Processor provides a pixel classification into properties 
such as clear/cloudy, land/water, snow, ice etc.

The Sentinel-3 Toolbox provides similar functionnality for MODIS
and Landsat-8 data.

#### New Radiometric Indices Processor

The Sentinel-2 Toolbox now includes an important number of well-known
radiometric indices processors, developped by CS-Romania.

The following indices are made available :
* Vegetation indices : DVI, RVI, PVI, IPVI, WDVI, TNDVI, GNDVI, GEMI, ARVI,
NDI45, MTCI, MCARI, REIP, S2REP, IRECI, PSSRa
* Soil indices : SAVI, TSAVI, MSAVI, MSAVI2, BI, BI2, RI, CI
* Water indices : NDWI, NDWI2, MNDWI, NDPI, NDTI

### List of solved issues





Changes in S2TBX 3.0
-----------------

* Main features
  * S2-MSI reader: many fixes and improvements, including
    * Big S2 datasets could lead to "Too many file opened" exceptions.
    * Angles grid now strictly fit to image in terms of size.
    * The S2 and JP2 readers were not usable in a headless environment.
    * Fixed description and units for S2 bands
    * Resource leaks detected by Coverity (https://scan.coverity.com/) fixed
    * Better validation of Angles Grid data
    * Color rendering of L2A Scene Classification now fits with PDD & ATBD
  * Spot-6 Reader
  * OTB tools integration via STA :
    * HaralickTextureExtraction
    * MeanShiftSmoothing
    * MultivariateAlterationDetector
    * Pansharpening-bayes
    * Pansharpening-lmvm
    * Pansharpening-rcs
    * Rasterization-image
    * Rasterization-manual
    * Segmentation-cc
    * Segmentation-meanshift
    * Segmentation-mprofiles
    * Segmentation-watershed
    * SFSTextureExtraction

* Solved issues
  * [SIITBX-90] - 'Export mask definition(s) to XML file does not work
  * [SIITBX-103] - Add Licences for each module
  * [SIITBX-128] - Nicely handle products with subset of bands
  * [SIITBX-144] - Unable to use openjpeg in a snap-engine only environment
  * [SIITBX-145] - S2 readers : Missing band description
  * [SIITBX-146] - S2 readers:  missing band unit
  * [SIITBX-153] - Angles of S2 product don't get saved correctly
  * [SIITBX-154] - Geo-referencement of S2 product don't get saved correctly
  * [SIITBX-161] - Decoding JPEG2000 files became slow
  * [SIITBX-168] - [L2A] Wrong description/unit for quality bands
  * [SIITBX-173] - "Too many open files" when reading big S2 datasets
  * [SIITBX-176] - Can't producd RGB with product DEIMOS-1_INDONESIA-TrueColor-22m.zip
  * [SIITBX-177] - JP2 Reader has no unit tests
  * [SIITBX-179] - Scottish effect when displaying 20m bands
  * [SIITBX-182] - Sentinel-2 reader a bottleneck for generally opening products
  * [SIITBX-184] - Problem with Spot 6 masks: memory consumption
  * [SIITBX-185] - SPOT 6 masks are displayed by default
  * [SIITBX-186] - Can't open product SPOT-6_1.5m_Ortho_Bundle_12_bits
  * [SIITBX-189] - Issue to open/import/read directly jpeg2000 files on Linux
  * [SIITBX-119] - Products read by S-2 MSI readers don't work well with spectrum view
  * [SIITBX-133] - Use JP2 reader for implementing S2MSI reader
  * [SIITBX-166] - Fix copyright headers in source code
  * [SIITBX-167] - Missing description and Unit for sun/view angles grids
  * [SIITBX-170] - [OpenJPEG] only deploy the binaries
  * [SIITBX-171] - [OpenJPEG] Set permissions during deployment in auxdata folder
  * [SIITBX-142] - Add SPOT 6-7 readers
  * [SIITBX-190] - OpenJPEG 2.1 outputs TIF with wrong reflectance value


Changes in S2TBX 2.0
-----------------

* S2-MSI reader
  * L1C
     * All spectral bands are read, either in native resolution, or resampled to a common resolution
     * Support for the latest PSD
     * Interpretation of all GML quality masks
  * L2A
     * All spectral bands are read by L2A reader, currently with resampling
     * Reading of AOT, Water Vapour, Cloud & Snow Confidence, Scene Classification
     * Support for products with tiles in different UTM zones, like in L1C reader
  * All S2 readers
     * Lots of code refactoring
     * Optimization of the mosaic operators processing chain
     * Fixed installation issues with OpenJPEG executables
     * Migration to NetBeans platform
     * Lots of bug fixes
* Sen2Cor Standalone Tool Adapter
  * Provided a new Sen2Cor plugin to call Sen2Cor from the S2TBX, based on generic StandAlone Tools Adapter
* SPOT reader
  * SPOT 1/2/3/4/5 support (DIMAP & SpotView)
  * SPOT4-Take5 & SPOT5-Take5 support
* RapidEye reader
* Deimos reader

* Closed issues :
    * [SIITBX-38] - L1C Reader Implementation
    * [SIITBX-39] - L2A Reader Implementation
    * [SIITBX-40] - L1B Reader implementation
    * [SIITBX-41] - Multi-Resolution support implementation
    * [SIITBX-42] - Read product over severall UTM zones implementation
    * [SIITBX-58] - Read GML masks
    * [SIITBX-69] - Synchronize S-2 project with SNAP-2.0.0-SNAPSHOT
    * [SIITBX-70] - Check the Multi-Size product feature
    * [SIITBX-71] - Adapt the S-2 reader to multi-resolution
    * [SIITBX-72] - Update of the readers name
    * [SIITBX-73] - Copyrights to fix
    * [SIITBX-74] - Solar angles should be displayed properly
    * [SIITBX-78] - Hard-code resolution information depending on the bands
    * [SIITBX-1] - Export of S2 product to GeoTiff and ENVI fails for some combination of bands
    * [SIITBX-43] - RapidEye reader misreading start time
    * [SIITBX-82] - Check L2A_AtmCorr.py lines 4783 - 4789 with original ATCOR code and correct, if needed
    * [SIITBX-87] - Sentinel-2 readers don't all appear in 'File --> Import --> Optical Sensors menu
    * [SIITBX-88] - Wrong file filters for S2 products with File --> Open Product
    * [SIITBX-91] - RGB Combination from generated bands does not work
    * [SIITBX-94] - It is not possible anymore to open a single granule.
    * [SIITBX-95] - Most graph builder operations are not working with S2 products
    * [SIITBX-97] - Cannot read latest L1B product
    * [SIITBX-98] - S2 reader tries to read dimap product
    * [SIITBX-99] - Multi UTM zones support for L2A
    * [SIITBX-102] - L1B granule width must be dynamically found
    * [SIITBX-104] - Masks appear only when they contain polygons
    * [SIITBX-106] - Sentinel-2 readers have NetBeans dependencies
    * [SIITBX-107] - NPE occurs in J2kProductReaderPlugin when trying to open file without extension
    * [SIITBX-108] - When opening a produt at 20 or 60m, references to 10m remains
    * [SIITBX-112] - L2A bands can't be opened at 10m
    * [SIITBX-123] - JP2 reader should use SNAP cache dir
    * [SIITBX-126] - Band to Scene transform for Multi resolution products
    * [SIITBX-127] - NPE when reading a L2A product via gpt
    * [SIITBX-129] - L2A reader should read scene classification, WV and AOT bands
    * [SIITBX-130] - L2A reader band names
    * [SIITBX-131] - S2 masks have too complicated names
    * [SIITBX-135] - Missing layer.xml for JP2 reader
    * [SIITBX-143] - File->Import->Sentinel2 menu does not work anymore
    * [SIITBX-147] - S2-L1C tile JP2 file not read correctly by JP2reader
    * [SIITBX-148] - MacOSX exception when reading a product in beta8
    * [SIITBX-149] - opening different instances with Sentinel-2 reader does not behave as expected
    * [SIITBX-150] - Can't open product with "Import->OpticalSensors->Sentinel2->S2-MSI L1C"
    * [SIITBX-152] - OpenJPEG can't decode some 20m bands
    * [SIITBX-155] - opj_decompress cannot be found if s2tbx is installed after main intallation
    * [SIITBX-156] - If S2TBX is installed via the plugin manager, S2 MSI Reader does not work
    * [SIITBX-158] - Handle OpenJPEG decoding errors
    * [SIITBX-159] - Multi-resolution reader on graph builder
    * [SIITBX-160] - L1C Cloud masks generate NPE
    * [SIITBX-162] - Synchronization of image views does not work correctly for MSI L1C products
    * [SIITBX-163] - S2 masks all have the same colour
    * [SIITBX-164] - Masks are available only for 10m bands in the mask manager
    * [SIITBX-68] - Graph Builder: update the S-2 processors
    * [SIITBX-75] - Fix the tests on S2
    * [SIITBX-115] - Change the cache dir for S2 readers
    * [SIITBX-2] - S2 L1C reader is resampling all bands at 10m
    * [SIITBX-101] - L1B reader should adapt JP2 tiling scheme dynamically
    * [SIITBX-116] - Missing S-2 MSI L1C reader that reads all bands at same size
    * [SIITBX-124] - JP2 reader architecture update
    * [SIITBX-134] - Mix of J2K and JP2 in J2K reader
    * [SIITBX-3] - CLONE - RQT 87, Smart configurator
    * [SIITBX-4] - S2 reader
    * [SIITBX-7] - Standalone tool adapter
    * [SIITBX-8] - 3rd party plugin
    * [SIITBX-9] - Undo/Redo
    * [SIITBX-10] - Progress indicator
    * [SIITBX-18] - Read S2 GML masks
    * [SIITBX-22] - Extract pixel value
    * [SIITBX-25] - Basic image filtering
    * [SIITBX-27] - Processor integrate L2A module
    * [SIITBX-30] - Benchmark by optimizer
    * [SIITBX-31] - Optimizer propose setup values
    * [SIITBX-32] - Re-running the smart configurator
    * [SIITBX-33] - Processing preview
    * [SIITBX-35] - Performance Optimization (2/8)
    * [SIITBX-36] - Predefined processing chains
